<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é†‰åŠ æå‹ - é¸æ“‡æ¨¡å¼</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="page-mode">
            <h1 class="mode-header">é¸æ“‡æ¨¡å¼</h1>
            <div id="modeLockedMessage" style="display: none; text-align: center; color: var(--neon-yellow); font-size: 1.2rem; margin-bottom: 20px;">
                âš ï¸ æ¨¡å¼å·²è¢«é–å®šï¼Œè«‹é¸æ“‡å·²è¨­å®šçš„æ¨¡å¼
            </div>
            <div class="cards-wrapper">
                <div id="familyModeCard" class="mode-card" onclick="initFamilyMode()">
                    <div class="card-title">é—”å®¶æ­¡æ¨¡å¼</div>
                    <div class="card-desc">ç©åˆ†åˆ¶<br>5å›åˆçµç®—<br>é©åˆè¼•é¬†ç©å®¶</div>
                </div>
                <div id="drunkModeCard" class="mode-card" onclick="initAlcoholicMode()">
                    <div class="card-title">ç„¡ä¹ƒé…’é¬¼æ¨¡å¼</div>
                    <div class="card-desc">ç›´çƒå°æ±º<br>è¼¸è€…å…¨ä¹¾<br>è†½å°å‹¿å…¥</div>
                </div>
            </div>
            <button class="neon-btn outline-btn uniform-btn" style="margin-top:50px;" onclick="window.location.href='/'">è¿”å›é¦–é </button>
        </div>
    </div>
    <script src="script.js"></script>
    <script>
        // æª¢æŸ¥æ¨¡å¼é–å®šç‹€æ…‹
        async function checkModeLock() {
            try {
                const response = await fetch('/api/room/state', {
                    credentials: 'include'
                });
                const state = await response.json();

                if (state.mode_selected && state.game_mode) {
                    console.log('ğŸ”’ æ¨¡å¼å·²é–å®š:', state.game_mode);

                    // é¡¯ç¤ºæç¤ºè¨Šæ¯
                    const messageEl = document.getElementById('modeLockedMessage');
                    if (messageEl) messageEl.style.display = 'block';

                    // ç¦ç”¨å¦ä¸€å€‹æ¨¡å¼
                    const familyCard = document.getElementById('familyModeCard');
                    const drunkCard = document.getElementById('drunkModeCard');

                    if (state.game_mode === 'family') {
                        // é–å®šé…’é¬¼æ¨¡å¼
                        if (drunkCard) {
                            drunkCard.style.opacity = '0.3';
                            drunkCard.style.cursor = 'not-allowed';
                            drunkCard.onclick = function(e) {
                                e.preventDefault();
                                alert('æ¨¡å¼å·²è¢«é–å®šç‚ºé—”å®¶æ­¡æ¨¡å¼');
                            };
                        }
                    } else if (state.game_mode === 'drunk') {
                        // é–å®šé—”å®¶æ­¡æ¨¡å¼
                        if (familyCard) {
                            familyCard.style.opacity = '0.3';
                            familyCard.style.cursor = 'not-allowed';
                            familyCard.onclick = function(e) {
                                e.preventDefault();
                                alert('æ¨¡å¼å·²è¢«é–å®šç‚ºé…’é¬¼æ¨¡å¼');
                            };
                        }
                    }
                }
            } catch (error) {
                console.error('æª¢æŸ¥æ¨¡å¼é–å®šç‹€æ…‹éŒ¯èª¤:', error);
            }
        }

        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥
        window.addEventListener('DOMContentLoaded', checkModeLock);
    </script>
</body>
</html>